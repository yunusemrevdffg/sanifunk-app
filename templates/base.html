<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaniFunk</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.sw.js" async=""></script>
    <script>
      window.OneSignal = window.OneSignal || [];
      OneSignal.push(function() {
        OneSignal.init({
          appId: "d870e250-c800-4f83-bacb-c05f6e08c99f",
          safari_web_id: "web.onesignal.auto.064f77c3-38e2-4752-9442-997c02b33663",
          notifyButton: { enable: true },
          allowLocalhostAsSecureOrigin: true,
        });
      });
    </script>
</head>
<body>
    <nav class="navbar">
        <a href="{{ url_for('index') }}">SaniFunk ðŸš¨</a>
        {% if session.get('email') %}
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('chat') }}">Chat</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        {% endif %}
    </nav>

    <div class="container">
        {% block content %}
        {% endblock %}
    </div>

    <div id="alarm-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; justify-content:center; align-items:center; color:white; flex-direction:column; text-align:center;">
        <h2 style="color:red; font-size: 2rem;">ðŸš¨ ALARM ðŸš¨</h2>
        <p id="alarm-msg" style="font-size: 1.2rem; margin: 20px;"></p>
        <button onclick="stopAlarm()" style="padding: 10px 20px; background: red; color: white; border: none; border-radius: 5px;">STOP</button>
    </div>

    <script>
        function stopAlarm() {
            fetch('/api/stop_alarm', {method: 'POST'}).then(() => {
                document.getElementById('alarm-overlay').style.display = 'none';
            });
        }

        {% if session.get('email') %}
        function checkAlarm() {
            fetch('/api/check_alarm')
            .then(res => res.json())
            .then(data => {
                if (data && data.active) {
                    document.getElementById('alarm-msg').innerText = data.msg;
                    document.getElementById('alarm-overlay').style.display = 'flex';
                }
            })
            .catch(err => console.log("Check failed"));
        }
        setInterval(checkAlarm, 3000);
        {% endif %}
    </script>
</body>
</html>